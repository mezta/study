var initFilter=function(){$(".filter-property .control-property").each(function(){$(this).click(function(){var i=$(this).find("span");i.hasClass("glyphicon-minus")?($(this).nextAll("ul").slideUp(),i.removeClass("glyphicon-minus").addClass("glyphicon-plus")):($(this).nextAll("ul").slideDown(),i.removeClass("glyphicon-plus").addClass("glyphicon-minus"))})}),$(".filter-property ul li a").each(function(){$(this).click(function(){$(this).hasClass("on")?$(this).removeClass("on").addClass("off"):$(this).removeClass("off").addClass("on"),$("#hdIndex").val(1),setTimeout(function(){filterProduct(!0)},400)})}),$(".control-clear").click(function(){$(".filter-property ul li a.on").each(function(){$(this).removeClass("on").addClass("off")}),$("#hdIndex").val(1),filterProduct(!0)}),$("#selOrder").change(function(){filterProduct(!0)})},filterProduct=function(){var t="nodeID="+$("#nid").val()+"&pager="+$("#hdIndex").val()+"&od="+$("#selOrder").val(),a="";$(".filter ul").each(function(){var i=$(this).attr("data-property");a="",$(this).find("a.on").each(function(){""!==a&&(a+=","),a+=encodeURIComponent($(this).attr("data-property"))}),""!==a&&(t+="&"+i+"="+a)}),$.get("/umbraco/Surface/product/filter?"+t,function(i){var t=$(".product-list");if(t.empty(),1==i.result){1<parseInt($("#hdIndex").val())?$(".hot-and-new").addClass("hide"):$(".hot-and-new").removeClass("hide");i.total;for(var a="",e=0;e<i.data.length;e++)if(a='<div class="col-md-4"><div class="product-item">',a+='<div class="product-item-img"><img src="'+i.data[e].listImage+'" class="img-responsive" alt="'+i.data[e].productName+'"></div>',i.data[e].isNew&&(a+='<div class="icon-hot-new"><img src="/assets/images/product/icon-new-tag.png"></div>'),i.data[e].isHot&&(a+='<div class="icon-hot-new"><img src="/assets/images/product/icon-hot-tag.png"></div>'),a+='<div class="product-item-info">',a+='<a class="pull-right btn-comparison" href="javascript:;" data-product-id="'+i.data[e].id+'" data-product-thum="'+i.data[e].productDetailImage+'" data-product-name="'+i.data[e].productName+'" data-product-model="'+i.data[e].newModel+'">+对比</a>',a+="<h5>"+i.data[e].productName+"</h5>",a+="</div>",a+='<div class="product-item-templete">',a+='<div class="templete-img"><img src="'+i.data[e].listImage+'" class="img-responsive" alt="'+i.data[e].productName+'">',a+='<a class="btn-hegii btn-hegii-default" href="'+i.data[e].link+'" target="_blank">了解详情&gt;</a></div>',i.data[e].isNew&&(a+='<div class="icon-hot-new"><img src="/assets/images/product/icon-new-tag.png"></div>'),i.data[e].isHot&&(a+='<div class="icon-hot-new"><img src="/assets/images/product/icon-hot-tag.png"></div>'),a+='<div class="templete-opera clearfix">',a+="<p>"+i.data[e].fab+"</p>",a+="</div>",a+="</div></div>",t.append(a),2===e){var o=$("#adLink").val();""!==o?t.append('<div class="col-md-12"><a href="'+o+'" target="_blank"><img src="'+$("#adImgSrc").val()+'" class="img-responsive"></a></div>'):t.append('<div class="col-md-12"><img src="'+$("#adImgSrc").val()+'" class="img-responsive"></div>')}refreshPagination(parseInt(i.total),9,10,function(){console.log("call back"),beginView(),initPagination(),initProductThumb()})}else $(".pagination").empty(),beginView(40)},"JSON")},beginView=function(i){var t=$(".default-kv").height();0<t&&(i?$("html,body").animate({scrollTop:t+i+"px"},200):$("html,body").animate({scrollTop:t+70+"px"},200))},initPagination=function(){$(".for-pagination a").each(function(){$(this).click(function(){var i=$(this).parent();if(!i.hasClass("active")&&!i.hasClass("disabled")){$(".for-pagination li.active").removeClass("active");var t=1;0<$(this).find("span").length?t="Previous"===$(this).attr("aria-label")?parseInt($("#hdIndex").val())-1:parseInt($("#hdIndex").val())+1:(t=$(this).attr("data-page"),i.addClass("active")),$(".for-pagination li[data-control="+t+"]").addClass("active"),$("#hdIndex").val(t),filterProduct(!1)}beginView()})})},initProductThumb=function(){$(".product-item .product-item-img img").each(function(){var o="";$(this).on("mouseover",function(){o=$(this).parent().nextAll(".product-item-templete");var i=$(this).parents(".product-item"),t=parseInt(110*i.width()/100),a=parseInt(i.find(".product-item-img").height()),e=0-parseInt(5*i.width()/100);o.find(".templete-img").css({width:t+"px",height:a+"px",left:e+"px"}),o.hover(function(){},function(){o.hide()}).fadeIn("slow")})})},getComparison=function(){var i=$.cookie("hegiiComp");$.get("/umbraco/Surface/product/GetProductByIds",{id:i},function(i){if(1===parseInt(i.result)){var t=$(".comparison-list");t.empty();for(var a=0;a<i.data.length;a++){var e='<div id="comparison-product-'+i.data[a].id+'" class="col-md-3">';e+='<div class="comparison-img"><img src="'+i.data[a].productDetailImage+'" class="img-responsive">',e+='<button type="button" class="close" data-control-id="'+i.data[a].id+'"><span aria-hidden="true">&times;</span></button>',e+="</div>",e+='<div class="comparison-info">',e+="<p>"+i.data[a].productName+"</p>",e+="<p>"+i.data[a].newModel+"</p>",e+="</div></div>",t.append(e)}$(".product-comparison").slideDown(),bindRemoveComparison()}},"JSON")},initComparison=function(){var e=$(".product-comparison");$(".product-comparison .btn-close").click(function(){e.slideUp()}),$(".comparison-title .btn-hegii-default").click(function(){if($(".comparison-list").children().length<2)return console.log("小于2个，不能对比;"),!1}),$(".btn-comparison").each(function(){$(this).click(function(){var i=$(this).attr("data-product-id");if(3<$(".comparison-list").children().length)e.slideDown();else if(0<$(".comparison-list #comparison-product-"+i).length)e.slideDown();else{var t=$.cookie("hegiiComp");if(void 0!==t&&""!==t){var a=t.split(",");a.indexOf(i)<0&&a.length<4&&$.cookie("hegiiComp",t+","+i,{expires:7,path:"/"})}else $.cookie("hegiiComp",i,{expires:7,path:"/"});getComparison()}})})},bindRemoveComparison=function(){$(".comparison-list button").off(),$(".comparison-list button").each(function(){$(this).on("click",function(){var i=$(this).attr("data-control-id");$(".comparison-list #comparison-product-"+i).remove();var t=$.cookie("hegiiComp");if(void 0!==t&&""!==t){var a=t.split(",");a.splice(a.indexOf(i),1),$.cookie("hegiiComp",a.join(),{expires:7,path:"/"})}0===$(".comparison-list .col-md-3").length&&$(".product-comparison").slideUp("fast")})})},initZoom=function(i){$("#zoom").trigger("zoom.destroy"),$("#zoom img").attr("src",i),$("#zoom").zoom({target:"#target",magnify:1,onZoomIn:function(){$("#target").show()},onZoomOut:function(){$("#target").hide()}})},initDetails=function(){new Swiper(".swiper-container",{loop:!1,slidesPerView:3,initialSlide:0,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",onInit:function(i){$(".swiper-wrapper .swiper-slide a").each(function(){$(this).click(function(){$(".swiper-wrapper .on").each(function(){$(this).removeClass("on")}),$(this).parent().addClass("on");var i=$(this).find("img").eq(0);initZoom(i.attr("src"))})}),$(".swiper-wrapper .swiper-slide-active a").click()}})},initProperty=function(){$(".property-list-item-title a").each(function(){$(this).click(function(){var i=$(this).find("span").eq(0),t=$(this).parent().next();t.hasClass("show")?(t.addClass("hidden").removeClass("show"),i.addClass("glyphicon-plus").removeClass("glyphicon-minus")):($(".property-list-item .show").addClass("hidden").removeClass("show"),$(".property-list-item .glyphicon-minus").addClass("glyphicon-plus").removeClass("glyphicon-minus"),t.addClass("show").removeClass("hidden"),i.addClass("glyphicon-minus").removeClass("glyphicon-plus"))})}),$(".property-list-item-title a").eq(0).click()},getSingle=function(a){var i=$("#selSeries").val();$.get("/umbraco/Surface/product/GetProductById",{id:i},function(i){if(1===parseInt(i.result)){var t=$(".table-row").eq(0).find(".table-cell").eq(a);3===a&&t.removeClass("cell-add"),t.html('<img src="'+i.data.productDetailImage+'" class="img-responsive"><h4>'+i.data.newModel+"</h4>"),$(".table-row").eq(1).find(".table-cell").eq(a).html("<ul><li>"+i.data.productHighlight.replace(/\n/g,"</li><li>")+"</li></ul>"),$(".table-row").eq(2).find(".table-cell").eq(a).html("<ul><li>"+i.data.productParameter.replace(/\n/g,"</li><li>")+"</li></ul>"),$(".table-row").eq(3).find(".table-cell").eq(a).html("<ul><li>"+i.data.productDetail.replace(/\n/g,"</li><li>")+"</li></ul>")}},"JSON")},initAddComp=function(){$(".product-add a").each(function(){$(this).click(function(){var i=$.cookie("hegiiComp"),t=$("#selSeries").val();if(void 0!==i&&""!==i){var a=i.split(",");a.indexOf(t)<0&&a.length<4&&($.cookie("hegiiComp",i+","+t,{expires:7,path:"/"}),getSingle(a.length))}})})};$(function(){$(".filter")&&$(".filter").hasClass("filter")&&(initFilter(),initProductThumb(),initPagination()),$(".comparison-list").hasClass("comparison-list")&&initComparison(),$(".details-thumbnails").hasClass("details-thumbnails")&&(initDetails(),initProductThumb(),initProperty(),$(".product-like .rank-like").click()),$(".comparison .table-content").hasClass("table-content")&&initAddComp()});